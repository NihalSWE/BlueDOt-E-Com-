{% extends "blue_dot/base.html" %}
{% load static %}

{% block custom_css %}
/* Modern Breadcrumb Area - Max 300px height with background banner */
.tp-breadcrumb-area {
  position: relative;
  height: 300px;
  max-height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: 1;
}

/* Dynamic background image from Django */
.tp-breadcrumb-area[data-bg] {
  background-image: var(--bg-image);
}

.tp-slider-spacing-inner {
  padding: 0;
}

.p-relative {
  position: relative;
}

.z-index-1 {
  z-index: 1;
}

/* Remove the old background shape structure */
.tp-breadcrumb-bg-shape {
  display: none;
}

/* Modern overlay with gradient */
.tp-breadcrumb-area::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(0, 0, 0, 0.6) 0%,
    rgba(0, 0, 0, 0.4) 50%,
    rgba(0, 0, 0, 0.7) 100%
  );
  z-index: 1;
}

/* Animated pattern overlay */
.tp-breadcrumb-area::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
  z-index: 1;
  animation: shimmer 3s ease-in-out infinite alternate;
}

@keyframes shimmer {
  0% { opacity: 0.3; }
  100% { opacity: 0.6; }
}

.tp-breadcrumb-content {
  position: relative;
  z-index: 2;
  text-align: center;
  color: #fff;
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.tp-breadcrumb-title {
  font-size: 3.5rem;
  font-weight: 800;
  margin-bottom: 1.5rem;
  line-height: 1.1;
  color: #fff;
  text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  letter-spacing: -0.02em;
  background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
}

.tp-breadcrumb-title::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 3px;
  background: linear-gradient(90deg, #667eea, #764ba2);
  border-radius: 2px;
}

.tp-split-text.right {
  animation: slideInUp 1s ease-out;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tp-breadcrumb-body {
  font-size: 1.2rem;
  margin: 0;
  color: rgba(255, 255, 255, 0.95);
  font-weight: 400;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  animation: fadeIn 1.2s ease-out 0.3s both;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.tp-breadcrumb-body .home {
  color: #fff;
  text-decoration: none;
  transition: all 0.3s ease;
  padding: 0.5rem 1rem;
  border-radius: 25px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.tp-breadcrumb-body .home:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  color: #fff;
  text-decoration: none;
}

.tp-breadcrumb-body .spacing {
  margin: 0 1rem;
  color: rgba(255, 255, 255, 0.6);
  font-size: 1.5rem;
  font-weight: 300;
}

.current-page {
  color: #ffd700;
  font-weight: 500;
}

/* Responsive Design */
@media (max-width: 1200px) {
  .tp-breadcrumb-area {
    height: 280px;
  }
  
  .tp-breadcrumb-title {
    font-size: 3rem;
  }
  
  .tp-breadcrumb-content {
    padding: 1.5rem;
  }
}

@media (max-width: 992px) {
  .tp-breadcrumb-area {
    height: 260px;
  }
  
  .tp-breadcrumb-title {
    font-size: 2.5rem;
    margin-bottom: 1.2rem;
  }
  
  .tp-breadcrumb-body {
    font-size: 1.1rem;
  }
  
  .tp-breadcrumb-content {
    padding: 1.2rem;
  }
}

@media (max-width: 768px) {
  .tp-breadcrumb-area {
    height: 240px;
  }
  
  .tp-breadcrumb-title {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  
  .tp-breadcrumb-body {
    font-size: 1rem;
    flex-direction: column;
    gap: 0.8rem;
  }
  
  .tp-breadcrumb-body .spacing {
    display: none;
  }
  
  .tp-breadcrumb-content {
    padding: 1rem;
  }
}

@media (max-width: 576px) {
  .tp-breadcrumb-area {
    height: 220px;
  }
  
  .tp-breadcrumb-title {
    font-size: 1.8rem;
    margin-bottom: 0.8rem;
  }
  
  .tp-breadcrumb-body {
    font-size: 0.9rem;
  }
  
  .tp-breadcrumb-body .home {
    padding: 0.4rem 0.8rem;
    font-size: 0.85rem;
  }
}

@media (max-width: 480px) {
  .tp-breadcrumb-area {
    height: 200px;
  }
  
  .tp-breadcrumb-title {
    font-size: 1.5rem;
  }
  
  .tp-breadcrumb-body {
    font-size: 0.85rem;
  }
  
  .tp-breadcrumb-content {
    padding: 0.8rem;
  }
}

@media (max-width: 360px) {
  .tp-breadcrumb-area {
    height: 180px;
  }
  
  .tp-breadcrumb-title {
    font-size: 1.3rem;
    margin-bottom: 0.6rem;
  }
  
  .tp-breadcrumb-body {
    font-size: 0.8rem;
  }
  
  .tp-breadcrumb-title::after {
    width: 40px;
    height: 2px;
  }
}

/* Container adjustments */
.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px;
}

@media (max-width: 768px) {
  .container {
    padding: 0 10px;
  }
}

/* Row adjustments */
.row {
  display: flex;
  flex-wrap: wrap;
  margin: 0 -15px;
}

.align-items-center {
  align-items: center;
}

/* Column adjustments */
[class*="col-"] {
  padding: 0 15px;
  width: 100%;
}

@media (min-width: 1200px) {
  .col-xl-5 { width: 41.666667%; }
}

@media (min-width: 992px) {
  .col-lg-6 { width: 50%; }
}

@media (min-width: 768px) {
  .col-md-8 { width: 66.666667%; }
}

/* Remove text centering for larger screens */
@media (min-width: 769px) {
  .tp-breadcrumb-content {
    text-align: left;
  }
  
  .tp-breadcrumb-body {
    justify-content: flex-start;
  }
  
  .tp-breadcrumb-title::after {
    left: 0;
    transform: none;
  }
}
{% endblock custom_css %}

{% block breadcrumb %}

<!-- breadcrumb area start -->
<section class="tp-breadcrumb-area tp-slider-spacing-inner p-relative z-index-1" 
         style="{% if banner.background_image %}background-image: url('{{ banner.background_image.url }}');{% else %}background-image: url('{% static 'assets/img/breadcrumb/default-banner.jpg' %}');{% endif %}     
    background-repeat: no-repeat;
    padding: 0px;
    height: 300px;
    background-position: center center;
    background-size: 100% 300px;">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-xl-5 col-lg-6 col-md-8 col-12">
          <div class="tp-breadcrumb-content">
            <h2 class="tp-breadcrumb-title tp-split-text right">{{ banner.title }}</h2>
            <div class="tp-breadcrumb-body">
              <a class="home" href="{% url 'home' %}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                Home
              </a>
              <span class="spacing">→</span>
              <span class="current-page">{{ banner.subtitle }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>
<!-- breadcrumb area end -->
  
{% endblock breadcrumb %}


{% block content %}  
<!-- shop-product area start -->
<section class="tp-shop-area pt-50 pb-120">
    <div class="container">
        <div class="row">
            <div class="col-xl-3 col-lg-4">
                <div class="tp-shop-sidebar mb-40">
                    <!-- Search Form -->
                    <form method="get" action="{% url 'shop' %}" class="tp-shop-sidebar-search mb-30 wow fadeInUp">
                        <input type="text" name="search" placeholder="Search Products" value="{{ search_query }}">
                        <button type="submit" class="tp-shop-sidebar-search-icon">
                            <i class="fa-regular fa-magnifying-glass"></i>
                        </button>
                    </form>

                    <!-- Categories Filter -->
                    <div class="tp-shop-sidebar-category mb-30 wow fadeInUp">
                        <h4 class="tp-shop-sidebar-title mb-25">Categories</h4>
                        <div class="tp-shop-sidebar-category-wrap">
                           {% for category in categories %}
                              <div class="tp-shop-sidebar-category-item {% if category.slug == selected_category %}active-category{% endif %}">
                                 <a href="?category={{ category.slug }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_option and sort_option != 'default' %}&sort={{ sort_option }}{% endif %}">
                                    {{ category.name }}
                                 </a>
                              </div>
                           {% endfor %}
                           {% if selected_category %}
                              <div class="tp-shop-sidebar-category-item">
                                 <a href="?{% if search_query %}search={{ search_query }}{% endif %}{% if sort_option and sort_option != 'default' %}&sort={{ sort_option }}{% endif %}">
                                    Clear Filter
                                 </a>
                              </div>
                           {% endif %}
                        </div>
                    </div>
           
              <!-- Price Range Filter -->
            <div class="tp-shop-sidebar-price mb-30 wow fadeInUp">
              <h4 class="tp-shop-sidebar-title mb-30">Price</h4>
              <div class="tp-shop-sidebar-price-wrap">
                <div class="tp-shop-sidebar-price-range">
                </div>
                <div class="tp-shop-sidebar-price-range-head">
                  <form method="get" action="{% url 'shop' %}">
                    <!-- Keep any existing filters in hidden inputs -->
                    {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
                    {% if selected_category %}<input type="hidden" name="category" value="{{ selected_category }}">{% endif %}
                    {% if sort_option %}<input type="hidden" name="sort" value="{{ sort_option }}">{% endif %}
                    
                    <div id="slider-range" class="ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content">
                      <div class="ui-slider-range ui-corner-all ui-widget-header"></div>
                      <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                      <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                    </div>
                    
        <div class="tp-shop-price-filter mt-25">
  <input type="text" id="amount" readonly style="border:none; font-weight:bold; width:200px; margin-right:10px;">
</div>

                    <!-- Hidden inputs to submit min and max -->
                    <input type="hidden" id="min_price" name="min_price" value="{{ request.GET.min_price }}">
                    <input type="hidden" id="max_price" name="max_price" value="{{ request.GET.max_price }}">
                  </form>
                </div>
              </div>
            </div>
                    <div class="tp-shop-sidebar-sell mb-30 wow fadeInUp">
                        <h4 class="tp-shop-sidebar-title mb-25">Recent products</h4>
                        <div class="tp-shop-sidebar-sell-wrap">
                              {% for recent_product in recent_products %}
                                 <div class="tp-shop-sidebar-sell-item d-flex mb-20">
                                    <div class="tp-shop-sidebar-sell-item-thumb">
                                          <a href="{% url 'product_detail' slug=recent_product.slug %}">
                                             <img src="{{ recent_product.thumbnail.url }}" alt="{{ recent_product.name }}">
                                          </a>
                                    </div>
                                    <div class="tp-shop-sidebar-sell-item-content">
                                          <h5 class="tp-shop-sidebar-sell-item-title"><a href="{% url 'product_detail' slug=recent_product.slug %}">{{ recent_product.name }}</a></h5>
                                          <div class="tp-shop-sidebar-sell-item-rating">
                                             <i class="fa-solid fa-star"></i>
                                             <i class="fa-solid fa-star"></i>
                                             <i class="fa-solid fa-star"></i>
                                             <i class="fa-solid fa-star"></i>
                                             <i class="fa-solid fa-star"></i>
                                          </div>
                                          <span>{{ recent_product.base_price }}</span>
                                    </div>
                                 </div>
                              {% endfor %}
                        </div>
                    </div>
                    <img src="{{ recent_product.thumbnail.url }}" alt="{{ recent_product.name }}">
                </div>
            </div>
            <div class="col-xl-9 col-lg-8">
                <div class="row align-items-center">
                    <div class="col-xl-6 col-lg-6 col-md-6 mb-30">
                      <div class="tp-product__filter-box tp-shop-filter-box flex-xs-wrap d-md-flex justify-content-end">
                        <div class="tp-product__filter tp-shop-filter">

                          <form method="get" id="sortForm">
                            <select name="sort" onchange="this.form.submit();">
                              <option value="" {% if not request.GET.sort %}selected{% endif %}>Default sorting</option>
                              <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Low to Hight</option>
                              <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>High to Low</option>
                              <option value="newest" {% if request.GET.sort == 'newest' %}selected{% endif %}>New Added</option>
                              <option value="sale" {% if request.GET.sort == 'sale' %}selected{% endif %}>On Sale</option>
                            </select>

                            <!-- preserve other GET params -->
                            {% for key, value in request.GET.items %}
                              {% if key != 'sort' %}
                                <input type="hidden" name="{{ key }}" value="{{ value }}">
                              {% endif %}
                            {% endfor %}
                          </form>

                        </div>
                      </div>
                    </div>


                  </div>
                <div class="row align-items-end mb-30">
                     {% for product in products %}
                        <div class="col-xl-4 col-lg-6 col-md-6">
                           <div class="product_wrapper two mb-30">
                                 <div class="product__item p-relative">
                                    <div class="product__top-brand d-flex justify-content-between mb-15">
                                          <div class="product__top-price">
                                             <a href="{% url 'product_detail' slug=product.slug %}">{% if product.final_price < product.base_price %}
                                              <span style="text-decoration: line-through; color: #999;">৳ {{ product.base_price }}</span>
                                              <span style="color: #E60000; font-weight: bold;">৳ {{ product.final_price }}</span>
                                          {% else %}
                                              ৳ {{ product.base_price }}
                                          {% endif %}
</a>
                                          </div>
                                    </div>
                                    <div class="product__thumb w-img p-relative fix mb-10">
                                       <a href="{% url 'product_detail' slug=product.slug %}">
                                          <img src="{{ product.thumbnail.url }}" alt="{{ product.name }}">
                                       </a>
                                       <div class="product__action d-flex flex-column flex-wrap">
                                         
                                          <button type="button" class="product-action-btn" data-bs-toggle="modal" data-bs-target="#productModal">
                                             <svg width="19" height="16" viewBox="0 0 19 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M9.49943 5.34978C8.23592 5.34978 7.20896 6.37595 7.20896 7.63732C7.20896 8.89774 8.23592 9.92296 9.49943 9.92296C10.7629 9.92296 11.7908 8.89774 11.7908 7.63732C11.7908 6.37595 10.7629 5.34978 9.49943 5.34978M9.49941 11.3456C7.45025 11.3456 5.78394 9.68213 5.78394 7.63738C5.78394 5.59169 7.45025 3.92725 9.49941 3.92725C11.5486 3.92725 13.2158 5.59169 13.2158 7.63738C13.2158 9.68213 11.5486 11.3456 9.49941 11.3456" fill="currentColor"></path>
                  
                                                <path d="M1.49145 7.63683C3.25846 11.5338 6.23484 13.8507 9.50001 13.8517C12.7652 13.8507 15.7416 11.5338 17.5086 7.63683C15.7416 3.7408 12.7652 1.42386 9.50001 1.42291C6.23579 1.42386 3.25846 3.7408 1.49145 7.63683V7.63683ZM9.50173 15.2742H9.49793H9.49698C5.56775 15.2714 2.03943 12.5219 0.0577129 7.91746C-0.0192376 7.73822 -0.0192376 7.53526 0.0577129 7.35601C2.03943 2.75248 5.5687 0.00306822 9.49698 0.000223018C9.49888 -0.000725381 9.49888 -0.000725381 9.49983 0.000223018C9.50173 -0.000725381 9.50173 -0.000725381 9.50268 0.000223018C13.4319 0.00306822 16.9602 2.75248 18.942 7.35601C19.0199 7.53526 19.0199 7.73822 18.942 7.91746C16.9612 12.5219 13.4319 15.2714 9.50268 15.2742H9.50173Z" fill="currentColor"></path>
                  
                                             </svg>
                                             <span class="product-action-tooltip">Quick view</span>
                                          </button>
                                          
                                       </div>
                                       <div class="product__add transition-3">
                                          <button type="button" class="product-add-cart-btn w-100">
                                             Add to Cart
                                          </button>
                                       </div>
                                    </div>
                                    <div class="product__content text-center">
                                       <div class="product__content-wrapper">
                                          <h3 class="product__title">
                                             <a href="{% url 'product_detail' slug=product.slug %}">{{ product.name }}</a>
                                          </h3>
                                       </div>
                                       <div class="product__rating d-flex justify-content-center">
                                          <span>
                                             <i class="fa-solid fa-star"></i>
                                          </span>
                                          <span>
                                             <i class="fa-solid fa-star"></i>
                                          </span>
                                          <span>
                                             <i class="fa-solid fa-star"></i>
                                          </span>
                                          <span>
                                             <i class="fa-solid fa-star"></i>
                                          </span>
                                          <span>
                                             <i class="fa-solid fa-star"></i>
                                          </span>
                                       </div>
                                    </div>
                                 </div>
                           </div>
                     </div>
                     {% endfor %}
                </div>
                <div class="row">
                    <div class="tp-postbox-pagination text-center wow fadeInUp" data-wow-delay=".3s" data-wow-duration="1s" style="visibility: visible; animation-duration: 1s; animation-delay: 0.3s; animation-name: fadeInUp;">
                        <nav>
                           <ul>
                                {% if products.has_previous %}
                                    <li>
                                        <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                            &laquo; First
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                            Previous
                                        </a>
                                    </li>
                                {% endif %}

                                {% for num in products.paginator.page_range %}
                                    {% if products.number == num %}
                                        <li>
                                            <a class="active" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                                {{ num }}
                                            </a>
                                        </li>
                                    {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                                        <li>
                                            <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                                {{ num }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}

                                {% if products.has_next %}
                                    <li>
                                        <a href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                            Next
                                        </a>
                                    </li>
                                    <li>
                                        <a href="?page={{ products.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}">
                                            Last &raquo;
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- shop-product area start -->
{% endblock content %}

{% block custom_js %}
<script>
$(document).ready(function() {
    $('select[name="sort"]').niceSelect();

    var dbMin = {{ min_price|default:0 }};
    var dbMax = {{ max_price|default:10000 }};

    var minVal = {% if request.GET.min_price %}{{ request.GET.min_price }}{% else %}dbMin{% endif %};
    var maxVal = {% if request.GET.max_price %}{{ request.GET.max_price }}{% else %}dbMax{% endif %};

    $("#slider-range").slider({
        range: true,
        min: dbMin,
        max: dbMax,
        values: [minVal, maxVal],
        slide: function(event, ui) {
            $("#min_price").val(ui.values[0]);
            $("#max_price").val(ui.values[1]);
            $("#amount").val('৳' + ui.values[0] + ' - ৳' + ui.values[1]);
        },
        stop: function(event, ui) {
            // Auto-submit the form when slider stops moving
            $("#min_price").val(ui.values[0]);
            $("#max_price").val(ui.values[1]);
            $("#amount").val('৳' + ui.values[0] + ' - ৳' + ui.values[1]);
            $(this).closest("form").submit();
        }
    });

    // Set default values
    $("#min_price").val(minVal);
    $("#max_price").val(maxVal);
    $("#amount").val('৳' + minVal + ' - ৳' + maxVal);

    // Optional: Auto-submit on manual input change
    $("#min_price, #max_price").on("change", function() {
        var min = parseInt($("#min_price").val()) || dbMin;
        var max = parseInt($("#max_price").val()) || dbMax;
        $("#slider-range").slider("values", [min, max]);
        $("#amount").val('৳' + min + ' - ৳' + max);
        $(this).closest("form").submit();
    });
});
</script>

{% endblock custom_js %}